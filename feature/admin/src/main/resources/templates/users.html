<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/base :: layout(title='Manage Users', content=~{::section}, script=~{::script})}">
<body>

<section>
  <div th:replace="~{layouts/fragments :: pageHeader(title='Manage Users', createBtnId=null, createBtnText=null)}"></div>

  <div class="table-wrapper">
    <table class="table">
      <thead>
      <tr>
        <th class="table__head-cell">Id</th>
        <th class="table__head-cell">Full Name</th>
        <th class="table__head-cell">Email</th>
        <th class="table__head-cell">Role</th>
        <th class="table__head-cell">Created At</th>
        <th class="table__head-cell">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="user : ${usersPage.content}" class="table__row">
        <td class="table__cell" th:text="${user.id}"></td>
        <td class="table__cell" th:text="${user.fullName}"></td>
        <td class="table__cell" th:text="${user.email}"></td>
        <td class="table__cell">
                <span th:text="${user.role}"
                      style="padding: 2px 8px; border-radius: 99px; background: #e0e7ff; color: #3730a3; font-size: 12px; font-weight: 600;">
                </span>
        </td>
        <td class="table__cell" th:text="${user.createdAt}"></td>

        <td class="table__cell">
          <div class="table__actions">
            <button type="button" class="button button--edit"
                    data-action="edit"
                    th:data-id="${user.id}"
                    th:data-fullname="${user.fullName}"
                    th:data-email="${user.email}"
                    th:data-role="${user.role}">
              Edit
            </button>
            <form th:action="@{/admin/users/{id}/delete(id=${user.id})}" method="post" style="margin: 0;">
              <button type="button" class="button button--danger" data-action="delete">Delete</button>
            </form>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div th:replace="~{layouts/fragments :: pagination(page=${usersPage}, url='/admin/users')}"></div>

  <div th:replace="~{layouts/fragments :: modal(id='editUserModal', title='Edit User', content=~{::#editUserForm})}">
    <form id="editUserForm" class="form" method="post">
      <div class="form__group">
        <label class="form__label">First Name</label>
        <input type="text" class="form__input" name="firstName" required>
      </div>
      <div class="form__group">
        <label class="form__label">Last Name</label>
        <input type="text" class="form__input" name="lastName" required>
      </div>
      <div class="form__group">
        <label class="form__label">Email</label>
        <input type="email" class="form__input" name="email" required>
      </div>
      <div class="form__group">
        <label class="form__label">Role</label>
        <select class="form__select" name="role">
          <option value="USER">USER</option>
          <option value="ADMIN">ADMIN</option>
        </select>
      </div>
      <button type="submit" class="button button--success">Save Changes</button>
    </form>
  </div>

  <div th:replace="~{layouts/fragments :: deleteModal(id='deleteConfirmModal', formId='deleteUserForm', text='Are you sure you want to delete this user? This action cannot be undone.')}"></div>
</section>

<script th:src="@{/js/users.js}"></script>

</body>
</html>