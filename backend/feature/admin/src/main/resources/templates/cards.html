<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/base :: layout(title='Manage Cards', content=~{::section}, script=~{::script})}">
<body>

<section>
    <div th:replace="~{layouts/fragments :: pageHeader(title='Manage Cards', createBtnId='openCreateModalBtn', createBtnText='Add Card')}"></div>

    <div class="table-wrapper">
        <table class="table">
            <thead>
            <tr>
                <th class="table__head-cell">ID</th>
                <th class="table__head-cell">Title</th>
                <th class="table__head-cell">Status</th>
                <th class="table__head-cell">Rarity</th>
                <th class="table__head-cell">Category</th>
                <th class="table__head-cell" style="width: 280px;">Actions</th> </tr>
            </thead>
            <tbody>
            <tr th:each="card : ${cardsPage.content}" class="table__row">
                <td class="table__cell" th:text="${card.id}"></td>
                <td class="table__cell">
                    <div style="font-weight: 500;" th:text="${card.title}"></div>
                    <div style="font-size: 0.75rem; color: #6b7280;" th:text="${card.slug}"></div>
                </td>
                <td class="table__cell">
                    <span th:text="${card.status}"
                          th:style="${card.status == 'Public' ? 'color: green; background: #dcfce7; padding: 2px 8px; border-radius: 99px; font-size: 12px; font-weight: 600;' : 'color: gray; background: #f3f4f6; padding: 2px 8px; border-radius: 99px; font-size: 12px; font-weight: 600;'}">
                    </span>
                </td>
                <td class="table__cell">
                     <span th:text="${card.rarity}"
                           style="padding: 2px 8px; border-radius: 4px; border: 1px solid #e5e7eb; font-size: 12px;">
                     </span>
                </td>
                <td class="table__cell" th:text="${card.category != null ? card.category.title : '-'}"></td>
                <td class="table__cell">
                    <div class="table__actions">

                        <a th:href="@{/admin/cards/content/{id}(id=${card.id})}"
                           class="button button--primary"
                           style="text-decoration: none; padding: 6px 12px; font-size: 13px; display: inline-flex; align-items: center;">
                            Content
                        </a>

                        <button type="button" class="button button--edit"
                                data-action="edit"
                                th:data-id="${card.id}"
                                th:data-title="${card.title}"
                                th:data-slug="${card.slug}"
                                th:data-description="${card.description}"
                                th:data-status="${card.status}"
                                th:data-rarity="${card.rarity}"
                                th:data-category-id="${card.category != null ? card.category.id : ''}">
                            Edit
                        </button>

                        <button type="button" class="button button--danger" data-action="delete" th:data-id="${card.id}">
                            Delete
                        </button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:replace="~{layouts/fragments :: pagination(page=${cardsPage}, url='/admin/cards')}"></div>

    <div th:replace="~{layouts/fragments :: modal(id='createCardModal', title='New Card', content=~{::#createCardForm})}">
        <form id="createCardForm" th:action="@{/admin/cards/create}" method="post" class="form">
            <div class="form__group">
                <label class="form__label">Title</label>
                <input type="text" class="form__input" name="title" required>
            </div>
            <div class="form__group">
                <label class="form__label">Slug</label>
                <input type="text" class="form__input" name="slug" placeholder="Auto-generated if empty">
            </div>
            <div style="display: flex; gap: 16px;">
                <div class="form__group" style="flex: 1;">
                    <label class="form__label">Status</label>
                    <select class="form__select" name="status">
                        <option value="Hidden">Hidden</option>
                        <option value="Public">Public</option>
                    </select>
                </div>
                <div class="form__group" style="flex: 1;">
                    <label class="form__label">Rarity</label>
                    <select class="form__select" name="rarity">
                        <option value="COMMON">Common</option>
                        <option value="RARE">Rare</option>
                        <option value="EPIC">Epic</option>
                    </select>
                </div>
            </div>
            <div class="form__group">
                <label class="form__label">Category</label>
                <select class="form__select" name="categoryId">
                    <option value="">No Category</option>
                    <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.title}"></option>
                </select>
            </div>
            <div class="form__group">
                <label class="form__label">Description</label>
                <textarea class="form__input" name="description" rows="3"></textarea>
            </div>
            <button type="submit" class="button button--success">Create Card</button>
        </form>
    </div>

    <div th:replace="~{layouts/fragments :: modal(id='editCardModal', title='Edit Card', content=~{::#editCardForm})}">
        <form id="editCardForm" method="post" class="form">
            <div class="form__group">
                <label class="form__label">Title</label>
                <input type="text" class="form__input" name="title" required>
            </div>
            <div class="form__group">
                <label class="form__label">Slug</label>
                <input type="text" class="form__input" name="slug">
            </div>
            <div style="display: flex; gap: 16px;">
                <div class="form__group" style="flex: 1;">
                    <label class="form__label">Status</label>
                    <select class="form__select" name="status">
                        <option value="Hidden">Hidden</option>
                        <option value="Public">Public</option>
                    </select>
                </div>
                <div class="form__group" style="flex: 1;">
                    <label class="form__label">Rarity</label>
                    <select class="form__select" name="rarity">
                        <option value="COMMON">Common</option>
                        <option value="RARE">Rare</option>
                        <option value="EPIC">Epic</option>
                    </select>
                </div>
            </div>
            <div class="form__group">
                <label class="form__label">Category</label>
                <select class="form__select" name="categoryId">
                    <option value="">No Category</option>
                    <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.title}"></option>
                </select>
            </div>
            <div class="form__group">
                <label class="form__label">Description</label>
                <textarea class="form__input" name="description" rows="3"></textarea>
            </div>
            <button type="submit" class="button button--success">Save Changes</button>
        </form>
    </div>

    <div th:replace="~{layouts/fragments :: deleteModal(id='deleteConfirmModal', formId='deleteCardForm', text='Are you sure you want to delete this card?')}"></div>
</section>

<script th:src="@{/js/cards.js}"></script>

</body>
</html>